<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>User guide</title>
<link rel="stylesheet" href="../../../doc/src/boostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="../index.html" title="Chapter&#160;1.&#160;Boost.Histogram">
<link rel="up" href="../index.html" title="Chapter&#160;1.&#160;Boost.Histogram">
<link rel="prev" href="getting_started.html" title="Getting started">
<link rel="next" href="benchmarks.html" title="Benchmarks">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../boost.png"></td>
<td align="center"><a href="../../../index.html">Home</a></td>
<td align="center"><a href="../../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="getting_started.html"><img src="../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="benchmarks.html"><img src="../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="histogram.guide"></a><a class="link" href="guide.html" title="User guide">User guide</a>
</h2></div></div></div>
<div class="toc"><dl class="toc">
<dt><span class="section"><a href="guide.html#histogram.guide.introduction">Introduction</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.create_a_histogram">Create a histogram</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.fill_histogram">Fill histogram</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.access_bin_counts">Access bin counts</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.arithmetic_operators">Arithmetic operators</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.reductions">Reductions</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.streaming">Streaming</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.serialization">Serialization</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.expert">Advanced usage</a></span></dt>
</dl></div>
<p>
      This guide covers the basic and more advanced usage of the library. It is designed
      to make simple things simple, yet complex things possible. For a quick start,
      you don't need to read the complete user guide; have a look at the <a class="link" href="getting_started.html" title="Getting started">Getting
      started</a> section.
    </p>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.introduction"></a><a class="link" href="guide.html#histogram.guide.introduction" title="Introduction">Introduction</a>
</h3></div></div></div>
<p>
        This library provides a templated <a href="https://en.wikipedia.org/wiki/Histogram" target="_top">histogram</a>
        class for multi-dimensional data. A histogram consists a number of non-overlapping
        consecutive cells in data space, called <span class="bold"><strong>bins</strong></span>.
        When a value is passed to the histogram, the corresponding bin that envelopes
        the value is found and an associated counter is incremented. In large data
        sets, keeping the bin counts in memory for analysis requires fewer resources
        than keeping the original value tuples. If the bins are small enough<a href="#ftn.histogram.guide.introduction.f0" class="footnote" name="histogram.guide.introduction.f0"><sup class="footnote">[2]</sup></a>, they still represent the original information in the data distribution.
        A histogram is therefore a useful lossy compression. It is also often used
        as a simple estimator for the <a href="https://en.wikipedia.org/wiki/Probability_density_function" target="_top">probability
        density function</a> of the input data. More complex density estimators
        exist, but histograms are easy to reason about.
      </p>
<p>
        Input for the histogram can be one- or multi-dimensional. In the multi-dimensional
        case, the input consist of tuples of values which belong together, describing
        different aspects of the same entity. A point in space is an example. You
        need three coordinate values to describe a point. The entity here is the
        point, and to fully characterize a point distribution in space you need three
        values and therefore a three-dimensional (3d) histogram. The advantage of
        using a 3d histogram over three separate 1d histograms, one for each coordinate,
        is that the 3d histogram is able to capture more information. For example,
        you could have a point distribution that looks like a checker board in three
        dimensions (a checker cube): high and low densities are alternating along
        each coordinate. Then the 1d histograms for each separate coordinate would
        look like flat distributions, completely hiding the complex structure, while
        the 3d histogram would retain the structure for further analysis.
      </p>
<p>
        The term <span class="emphasis"><em>histogram</em></span> is usually strictly used for something
        with bins over discrete or continuous data. The histogram class can also
        process categorical variables and it even allows for non-consecutive bins
        if that is desired. There is no restriction to numbers as input. Any type
        can be fed into the histogram, if the user provides a specialized axis class
        that maps values of this type to a bin index. The only remaining restriction
        is that bins are non-overlapping, since there must be a unique mapping from
        input value to bin. The library is not able to automatically ensure this
        for user-provided axis classes, so the responsibily is on the implementer.
      </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.create_a_histogram"></a><a class="link" href="guide.html#histogram.guide.create_a_histogram" title="Create a histogram">Create a histogram</a>
</h3></div></div></div>
<div class="toc"><dl class="toc">
<dt><span class="section"><a href="guide.html#histogram.guide.create_a_histogram.static_or_dynamic_histogram">Static
        or dynamic histogram</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.create_a_histogram.axis_configuration">Axis
        configuration</a></span></dt>
</dl></div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="histogram.guide.create_a_histogram.static_or_dynamic_histogram"></a><a class="link" href="guide.html#histogram.guide.create_a_histogram.static_or_dynamic_histogram" title="Static or dynamic histogram">Static
        or dynamic histogram</a>
</h4></div></div></div>
<p>
          The histogram host class can store axis objects in a static or dynamic
          container, see the <a class="link" href="rationale.html#histogram.rationale.histogram_host" title="Histogram host class">rationale</a>
          for details. Use the factory functions <code class="computeroutput"><a class="link" href="reference.html#boost.histogram.make_static_histogram">make_static_histogram</a></code>
          and <code class="computeroutput"><a class="link" href="reference.html#boost.histogram.make_dynam_idm499186002256">make_dynamic_histogram</a></code>
          to make the corresponding histograms. Using static histograms is recommended,
          because they are faster and usage errors are caught at compile-time. Use
          dynamic histogram, if:
        </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
              You only know the axis configurations at runtime, not at compile-time.
            </li>
<li class="listitem">
              You want to use a single type in your C++ code that operates on histograms
              and avoid templated functions.
            </li>
</ul></div>
<p>
          These factory functions create histograms with the default storage type
          <code class="computeroutput"><a class="link" href="../boost/histogram/adaptive_storage.html" title="Struct template adaptive_storage">boost::histogram::adaptive_storage</a></code>,
          which provides safe counting, is fast and memory efficient. If you think
          you need another storage type or if you want to create your own, have a
          look at the section <a class="link" href="guide.html#histogram.guide.expert" title="Advanced usage">Advanced Usage</a>.
        </p>
<p>
          Here is an example on how to use <code class="computeroutput"><a class="link" href="reference.html#boost.histogram.make_static_histogram">make_static_histogram</a></code>.
          You pass one or several axis instances, which define the layout of the
          histogram.
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="comment">/*
      create a 1d-histogram in default configuration which
      covers the real line from -1 to 1 in 100 bins, the same
      call with `make_dynamic_histogram` would also work
  */</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">100</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">));</span>

  <span class="comment">// do something with h</span>
<span class="special">}</span>
</pre>
<p>
          An axis object defines how input values are mapped to bins, which means
          that it defines the number of bins along that axis and a mapping function
          from input values to bins. If you provide one axis, the histogram is one-dimensional.
          If you provide two, it is two-dimensional, and so on.
        </p>
<p>
          When you work with dynamic histograms, you can also create a sequence of
          axes at run-time and pass them to the factory:
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">vector</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="comment">// create vector of axes, axis::any is a polymorphic axis type</span>
  <span class="keyword">auto</span> <span class="identifier">v</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">any_std</span><span class="special">&gt;();</span>
  <span class="identifier">v</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">100</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">));</span>
  <span class="identifier">v</span><span class="special">.</span><span class="identifier">push_back</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">integer</span><span class="special">&lt;&gt;(</span><span class="number">1</span><span class="special">,</span> <span class="number">7</span><span class="special">));</span>

  <span class="comment">// create dynamic histogram (make_static_histogram cannot be used with iterators)</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_dynamic_histogram</span><span class="special">(</span><span class="identifier">v</span><span class="special">.</span><span class="identifier">begin</span><span class="special">(),</span> <span class="identifier">v</span><span class="special">.</span><span class="identifier">end</span><span class="special">());</span>

  <span class="comment">// do something with h</span>



  <span class="comment">// make_dynamic_histogram copies axis objects; to instead move the whole axis</span>
  <span class="comment">// vector into the histogram, create a histogram instance directly</span>
  <span class="keyword">auto</span> <span class="identifier">h2</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">&lt;</span><span class="keyword">decltype</span><span class="special">(</span><span class="identifier">v</span><span class="special">)&gt;(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">move</span><span class="special">(</span><span class="identifier">v</span><span class="special">));</span>

  <span class="comment">// do something with h2</span>
<span class="special">}</span>
</pre>
<p>
          <code class="computeroutput"><a class="link" href="reference.html#boost.histogram.make_static_histogram">make_static_histogram</a></code>
          cannot handle this case because a static histogram can only be constructed
          when the number and types of all axes are known already at compile time.
          While strictly speaking that is also true in this example, you could have
          filled the vector also at run-time, based on run-time user input.
        </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
            Memory for bin counters is allocated lazily, if the default storage policy
            <code class="computeroutput"><a class="link" href="../boost/histogram/adaptive_storage.html" title="Struct template adaptive_storage">adaptive_storage</a></code>
            is used. Allocation is delayed to the first time, when input values are
            passed to the histogram. Therefore memory allocation exceptions are not
            thrown when the histogram is created, but possibly later. This gives
            you a chance to check how much memory the histogram will allocate and
            possibly give a warning if that amount is excessively large. Use the
            method <code class="computeroutput"><span class="identifier">histogram</span><span class="special">::</span><span class="identifier">size</span><span class="special">()</span></code>
            to see how many bins your axis layout requires. At the first fill, that
            many bytes will be allocated. The allocated amount of memory may grow
            further later when the capacity of the bin counters needs to grow.
          </p></td></tr>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="histogram.guide.create_a_histogram.axis_configuration"></a><a class="link" href="guide.html#histogram.guide.create_a_histogram.axis_configuration" title="Axis configuration">Axis
        configuration</a>
</h4></div></div></div>
<p>
          The library comes with a number of axis classes (you can write your own,
          too, see <a class="link" href="guide.html#histogram.guide.expert" title="Advanced usage">Advanced usage</a>).
          The <code class="computeroutput"><a class="link" href="../boost/histogram/axis/regular.html" title="Class template regular">regular axis</a></code>
          should be your default choice, because it is simple and efficient. It splits
          an interval over a continuous variable into <code class="computeroutput"><span class="identifier">N</span></code>
          bins of equal width. If you want bins over a range of integers, the <code class="computeroutput"><a class="link" href="../boost/histogram/axis/integer.html" title="Class template integer">integer axis</a></code> is faster.
          If you have data which wraps around, like angles, use a <code class="computeroutput"><a class="link" href="../boost/histogram/axis/circular.html" title="Class template circular">circular
          axis</a></code>. If your bins vary in width, use a <code class="computeroutput"><a class="link" href="../boost/histogram/axis/variable.html" title="Class template variable">variable
          axis</a></code>. If you want to bin categorical values, like <code class="computeroutput"><span class="identifier">red</span></code>, <code class="computeroutput"><span class="identifier">blue</span></code>,
          <code class="computeroutput"><span class="identifier">green</span></code>, you can use a <code class="computeroutput"><a class="link" href="../boost/histogram/axis/category.html" title="Class template category">category axis</a></code>.
        </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
            All axes which define bins in terms of intervals always use semi-open
            intervals by convention. The last value is never included. For example,
            the axis <code class="computeroutput"><span class="identifier">axis</span><span class="special">::</span><span class="identifier">integer</span><span class="special">&lt;&gt;(</span><span class="number">0</span><span class="special">,</span> <span class="number">3</span><span class="special">)</span></code> has three bins with intervals <code class="computeroutput"><span class="special">[</span><span class="number">0</span><span class="special">,</span>
            <span class="number">1</span><span class="special">),</span> <span class="special">[</span><span class="number">1</span><span class="special">,</span>
            <span class="number">2</span><span class="special">),</span> <span class="special">[</span><span class="number">2</span><span class="special">,</span>
            <span class="number">3</span><span class="special">)</span></code>.
            To remember this, think of iterator ranges from <code class="computeroutput"><span class="identifier">begin</span></code>
            to <code class="computeroutput"><span class="identifier">end</span></code>, where <code class="computeroutput"><span class="identifier">end</span></code> is also not included.
          </p></td></tr>
</table></div>
<p>
          Check the class descriptions for more information about each axis type.
          All axes are templated on the data type, which means that you can use a
          <code class="computeroutput"><a class="link" href="../boost/histogram/axis/regular.html" title="Class template regular">regular axis</a></code>
          with floats or doubles, an <code class="computeroutput"><a class="link" href="../boost/histogram/axis/integer.html" title="Class template integer">integer
          axis</a></code> with any kind of integer, and so on. Reasonable defaults
          are provided, so usually you just pass an empty bracket to the class, like
          in most examples in this guide.
        </p>
<p>
          The <code class="computeroutput"><a class="link" href="../boost/histogram/axis/regular.html" title="Class template regular">regular axis</a></code>
          also accepts a second template parameter, a class that implements a bijective
          transform between the data space and the space where the bins are equi-distant.
          A <code class="computeroutput"><a class="link" href="../boost/histogram/axis/transform/log.html" title="Struct log">log transform</a></code>
          is useful for data that is strictly positive and spans over many orders
          of magnitude (masses of stellar objects are an example). Several other
          transforms are provided. Users can define their own transforms and use
          them with the axis.
        </p>
<p>
          In addition to the required parameters for an axis, you can assign an optional
          label to any axis, which helps to remember what the axis is about. Example:
          you have census data and you want to investigate how yearly income correlates
          with age, you could do:
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="comment">// create a 2d-histogram with an "age" and an "income" axis</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span>
      <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">20</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">100</span><span class="special">,</span> <span class="string">"age in years"</span><span class="special">),</span>
      <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">20</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">100</span><span class="special">,</span> <span class="string">"yearly income in $1000"</span><span class="special">));</span>

  <span class="comment">// do something with h</span>
<span class="special">}</span>
</pre>
<p>
          Without the labels it would be difficult to remember which axis was covering
          which quantity, because they look the same otherwise. Labels are the only
          axis property that can be changed later. Axes objects with different label
          do not compare equal with <code class="computeroutput"><span class="keyword">operator</span><span class="special">==</span></code>.
        </p>
<p>
          By default, additional under- and overflow bins are added automatically
          for each axis where that makes sense. If you create an axis with 20 bins,
          the histogram will actually have 22 bins along that axis. The two extra
          bins are generally very good to have, as explained in <a class="link" href="rationale.html#histogram.rationale.uoflow" title="Under- and overflow bins">the
          rationale</a>. If you are certain that the input cannot exceed the axis
          range, you can disable the extra bins to save memory. This is done by passing
          the enum value <code class="computeroutput"><a class="link" href="reference.html#boost.histogram.axis.uoflow_type">uoflow_type::off</a></code>
          to the axis constructor:
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="comment">// create a 1d-histogram for dice throws with integer values from 1 to 6</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span>
      <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">integer</span><span class="special">&lt;&gt;(</span><span class="number">1</span><span class="special">,</span> <span class="number">7</span><span class="special">,</span> <span class="string">"eyes"</span><span class="special">,</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">uoflow_type</span><span class="special">::</span><span class="identifier">off</span><span class="special">));</span>

  <span class="comment">// do something with h</span>
<span class="special">}</span>
</pre>
<p>
          We use an <code class="computeroutput"><a class="link" href="../boost/histogram/axis/integer.html" title="Class template integer">integer axis</a></code>
          here, because the input values are integers and we want one bin for each
          eye value.
        </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
            The <code class="computeroutput"><a class="link" href="../boost/histogram/axis/circular.html" title="Class template circular">circular axis</a></code>
            never creates under- and overflow bins. The highest bin wraps around
            to the lowest bin and vice versa, so there is no possibility for overflow.
            The <code class="computeroutput"><a class="link" href="../boost/histogram/axis/category.html" title="Class template category">category axis</a></code>
            comes only with an "overflow" bin, which counts all types of
            categorical input that was not recognized.
          </p></td></tr>
</table></div>
</div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.fill_histogram"></a><a class="link" href="guide.html#histogram.guide.fill_histogram" title="Fill histogram">Fill histogram</a>
</h3></div></div></div>
<p>
        After you created a histogram, you want to insert tuples of possibly multi-dimensional
        and heterogenous values. This is done with the flexible <code class="computeroutput"><span class="identifier">histogram</span><span class="special">(...)</span></code> call, which you typically do in a loop.
        Some extra parameters can be passed to the method as shown in the next example.
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">utility</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">vector</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">8</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">4</span><span class="special">),</span>
                                     <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">10</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">5</span><span class="special">));</span>

  <span class="comment">// fill histogram, number of arguments must be equal to number of axes</span>
  <span class="identifier">h</span><span class="special">(</span><span class="number">0</span><span class="special">,</span> <span class="number">1.1</span><span class="special">);</span>                <span class="comment">// increases bin counter by one</span>
  <span class="identifier">h</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">weight</span><span class="special">(</span><span class="number">2</span><span class="special">),</span> <span class="number">3</span><span class="special">,</span> <span class="number">3.4</span><span class="special">);</span> <span class="comment">// increase bin counter by 2 instead of 1</span>

  <span class="comment">// histogram also supports fills from a container of values; a container</span>
  <span class="comment">// of wrong size trips an assertion in debug mode</span>
  <span class="keyword">auto</span> <span class="identifier">xy1</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">make_pair</span><span class="special">(</span><span class="number">4</span><span class="special">,</span> <span class="number">3.1</span><span class="special">);</span>
  <span class="identifier">h</span><span class="special">(</span><span class="identifier">xy1</span><span class="special">);</span>
  <span class="keyword">auto</span> <span class="identifier">xy2</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="keyword">double</span><span class="special">&gt;({</span><span class="number">3.0</span><span class="special">,</span> <span class="number">4.9</span><span class="special">});</span>
  <span class="identifier">h</span><span class="special">(</span><span class="identifier">xy2</span><span class="special">);</span>

  <span class="comment">// functional-style processing is also supported</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">&lt;</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">pair</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">,</span> <span class="keyword">double</span><span class="special">&gt;&gt;</span> <span class="identifier">input_data</span><span class="special">{</span>
      <span class="special">{</span><span class="number">0</span><span class="special">,</span> <span class="number">1.2</span><span class="special">},</span> <span class="special">{</span><span class="number">2</span><span class="special">,</span> <span class="number">3.4</span><span class="special">},</span> <span class="special">{</span><span class="number">4</span><span class="special">,</span> <span class="number">5.6</span><span class="special">}};</span>
  <span class="comment">// std::for_each takes the functor by value, thus it potentially makes</span>
  <span class="comment">// expensive copies of the histogram, but modern compilers are usually smart</span>
  <span class="comment">// enough to avoid the superfluous copies</span>
  <span class="keyword">auto</span> <span class="identifier">h2</span> <span class="special">=</span>
      <span class="identifier">std</span><span class="special">::</span><span class="identifier">for_each</span><span class="special">(</span><span class="identifier">input_data</span><span class="special">.</span><span class="identifier">begin</span><span class="special">(),</span> <span class="identifier">input_data</span><span class="special">.</span><span class="identifier">end</span><span class="special">(),</span>
                    <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">8</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">4</span><span class="special">),</span>
                                              <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">10</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">5</span><span class="special">)));</span>
  <span class="comment">// h2 is filled</span>
<span class="special">}</span>
</pre>
<p>
        <code class="computeroutput"><span class="identifier">histogram</span><span class="special">(...)</span></code>
        either takes <code class="computeroutput"><span class="identifier">N</span></code> arguments
        or a container with <code class="computeroutput"><span class="identifier">N</span></code> elements,
        where <code class="computeroutput"><span class="identifier">N</span></code> is equal to the number
        of axes of the histogram. It finds the corresponding bin, and increments
        the bin counter by one.
      </p>
<p>
        <code class="computeroutput"><span class="identifier">histogram</span><span class="special">(</span><span class="identifier">weight</span><span class="special">(</span><span class="identifier">x</span><span class="special">),</span> <span class="special">...)</span></code>
        does the same as the first call, but increments the bin counter by the value
        <code class="computeroutput"><span class="identifier">x</span></code>. The type of <code class="computeroutput"><span class="identifier">x</span></code> is not restricted, usually it is a real
        number. The <code class="computeroutput"><span class="identifier">weight</span><span class="special">(</span><span class="identifier">x</span><span class="special">)</span></code> helper
        class must be first argument. You can freely mix calls with and without a
        <code class="computeroutput"><span class="identifier">weight</span></code>. Calls without a
        <code class="computeroutput"><span class="identifier">weight</span></code> act like the weight
        is <code class="computeroutput"><span class="number">1</span></code>.
      </p>
<p>
        Why weighted increments are sometimes useful, especially in a scientific
        context, is explained <a class="link" href="rationale.html#histogram.rationale.weights" title="Support of weighted fills">in the
        rationale</a>. If you don't see the point, you can just ignore this type
        of call. This feature does not affect the performance of the histogram if
        you don't use it.
      </p>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          The first call to a weighted fill internally switches the default storage
          from integral counters to another type, which holds two real numbers per
          bin, one for the sum of weights (the weighted count), and another for the
          sum of weights squared (the variance of the weighted count). This is not
          necessary for unweighted fills, because the two sums are identical is all
          weights are <code class="computeroutput"><span class="number">1</span></code>. The default
          storage automatically optimizes this case by using only one integral number
          per bin as long as no weights are encountered.
        </p></td></tr>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.access_bin_counts"></a><a class="link" href="guide.html#histogram.guide.access_bin_counts" title="Access bin counts">Access bin counts</a>
</h3></div></div></div>
<p>
        After the histogram has been filled, you want to access the counts per bin
        at some point. You may want to visualize the counts, or compute some quantities
        like the mean from the data distribution approximated by the histogram.
      </p>
<p>
        To access each bin, you use a multi-dimensional index, which consists of
        a sequence of bin indices for each axes in order. You can use this index
        to access the value for each and the variance estimate, using the method
        <code class="computeroutput"><span class="identifier">histogram</span><span class="special">::</span><span class="identifier">at</span><span class="special">(...)</span></code>
        (in analogy to <code class="computeroutput"><span class="identifier">std</span><span class="special">::</span><span class="identifier">vector</span><span class="special">::</span><span class="identifier">at</span></code>). It accepts integral indices, one for
        each axis of the histogram, and returns the associated bin counter type.
        The bin counter type then allows you to access the count value and its variance.
      </p>
<p>
        The calls are demonstrated in the next example.
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">numeric</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="comment">// make histogram with 2 x 2 = 4 bins (not counting under-/overflow bins)</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">),</span>
                                     <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="number">2</span><span class="special">,</span> <span class="number">4</span><span class="special">));</span>

  <span class="identifier">h</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">weight</span><span class="special">(</span><span class="number">1</span><span class="special">),</span> <span class="special">-</span><span class="number">0.5</span><span class="special">,</span> <span class="number">2.5</span><span class="special">);</span> <span class="comment">// bin index 0, 0</span>
  <span class="identifier">h</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">weight</span><span class="special">(</span><span class="number">2</span><span class="special">),</span> <span class="special">-</span><span class="number">0.5</span><span class="special">,</span> <span class="number">3.5</span><span class="special">);</span> <span class="comment">// bin index 0, 1</span>
  <span class="identifier">h</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">weight</span><span class="special">(</span><span class="number">3</span><span class="special">),</span> <span class="number">0.5</span><span class="special">,</span> <span class="number">2.5</span><span class="special">);</span>  <span class="comment">// bin index 1, 0</span>
  <span class="identifier">h</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">weight</span><span class="special">(</span><span class="number">4</span><span class="special">),</span> <span class="number">0.5</span><span class="special">,</span> <span class="number">3.5</span><span class="special">);</span>  <span class="comment">// bin index 1, 1</span>

  <span class="comment">// access count value, number of indices must match number of axes</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">,</span> <span class="number">0</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">,</span> <span class="number">1</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span>
            <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">1</span><span class="special">,</span> <span class="number">0</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>

  <span class="comment">// prints: 1 2 3 4</span>

  <span class="comment">// access count variance, number of indices must match number of axes</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">,</span> <span class="number">0</span><span class="special">).</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">,</span> <span class="number">1</span><span class="special">).</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span>
            <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">1</span><span class="special">,</span> <span class="number">0</span><span class="special">).</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">).</span><span class="identifier">variance</span><span class="special">()</span>
            <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 1 4 9 16</span>

  <span class="comment">// this is more efficient when you want to query value and variance</span>
  <span class="keyword">auto</span> <span class="identifier">c11</span> <span class="special">=</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">);</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">c11</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">c11</span><span class="special">.</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 4 16</span>

  <span class="comment">// histogram also supports access via container; using a container of</span>
  <span class="comment">// wrong size trips an assertion in debug mode</span>
  <span class="keyword">auto</span> <span class="identifier">idx</span> <span class="special">=</span> <span class="special">{</span><span class="number">0</span><span class="special">,</span> <span class="number">1</span><span class="special">};</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="identifier">idx</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 2</span>

  <span class="comment">// histogram also provides bin iterators</span>
  <span class="keyword">auto</span> <span class="identifier">sum</span> <span class="special">=</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">accumulate</span><span class="special">(</span><span class="identifier">h</span><span class="special">.</span><span class="identifier">begin</span><span class="special">(),</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">end</span><span class="special">(),</span>
                             <span class="keyword">typename</span> <span class="keyword">decltype</span><span class="special">(</span><span class="identifier">h</span><span class="special">)::</span><span class="identifier">element_type</span><span class="special">(</span><span class="number">0</span><span class="special">));</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">sum</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sum</span><span class="special">.</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 10 30</span>

  <span class="comment">// bin iterators are fancy iterators with extra methods</span>
  <span class="keyword">for</span> <span class="special">(</span><span class="keyword">auto</span> <span class="identifier">it</span> <span class="special">=</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">begin</span><span class="special">(),</span> <span class="identifier">end</span> <span class="special">=</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">end</span><span class="special">();</span> <span class="identifier">it</span> <span class="special">!=</span> <span class="identifier">end</span><span class="special">;</span> <span class="special">++</span><span class="identifier">it</span><span class="special">)</span> <span class="special">{</span>
    <span class="keyword">const</span> <span class="keyword">auto</span> <span class="identifier">x</span> <span class="special">=</span> <span class="special">*</span><span class="identifier">it</span><span class="special">;</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">it</span><span class="special">.</span><span class="identifier">idx</span><span class="special">(</span><span class="number">0</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">it</span><span class="special">.</span><span class="identifier">idx</span><span class="special">(</span><span class="number">1</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="string">": "</span>
              <span class="special">&lt;&lt;</span> <span class="identifier">x</span><span class="special">.</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">x</span><span class="special">.</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="special">}</span>
  <span class="comment">// prints: (iteration order is an implementation detail, don't rely on it)</span>
  <span class="comment">// 0 0: 1 1</span>
  <span class="comment">// 1 0: 3 9</span>
  <span class="comment">// ...</span>
  <span class="comment">// 2 -1: 0 0</span>
  <span class="comment">// -1 -1: 0 0</span>
<span class="special">}</span>
</pre>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          The numbers returned by <code class="computeroutput"><span class="identifier">value</span><span class="special">()</span></code> and <code class="computeroutput"><span class="identifier">variance</span><span class="special">()</span></code> are always equal, if weighted fills are
          not used. The internal structure, which handles the bin counters, has been
          optimised for this common case. Internally only a single integral number
          per bin is used until a weighted fill, then the counters internally switch
          to storing two real numbers per bin. If the very first call to <code class="computeroutput"><span class="identifier">histogram</span><span class="special">(...)</span></code>
          is already a weighted increment, the two real numbers per bin are allocated
          directly without any superfluous conversion from integral counters to double
          counters. This special case is efficiently handled.
        </p></td></tr>
</table></div>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.arithmetic_operators"></a><a class="link" href="guide.html#histogram.guide.arithmetic_operators" title="Arithmetic operators">Arithmetic operators</a>
</h3></div></div></div>
<p>
        Some arithmetic operations are supported for histograms. Histograms are...
      </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
            equal comparable
          </li>
<li class="listitem">
            addable (adding histograms with non-matching axes is an error)
          </li>
<li class="listitem">
            multipliable and divisible by a number
          </li>
</ul></div>
<p>
        These operations are commutative, except for division. Dividing a number
        by a histogram is not implemented.
      </p>
<p>
        Two histograms compare equal, if...
      </p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
            all axes compare equal, including axis labels
          </li>
<li class="listitem">
            all values and variance estimates compare equal
          </li>
</ul></div>
<p>
        Adding histograms is useful, if you want to parallelize the filling of a
        histogram over several threads or processes. Fill independent copies of the
        histogram in worker threads, and then add them all up in the main thread.
      </p>
<p>
        Multiplying by a number is useful to re-weight histograms before adding them,
        for those who need to work with weights. Multiplying by a factor <code class="computeroutput"><span class="identifier">x</span></code> has a different effect on value and variance
        of each bin counter. The value is multiplied by <code class="computeroutput"><span class="identifier">x</span></code>,
        but the variance is multiplied by <code class="computeroutput"><span class="identifier">x</span><span class="special">*</span><span class="identifier">x</span></code>. This
        follows from the properties of the variance, as explained in <a class="link" href="rationale.html#histogram.rationale.variance" title="Variance estimates">the
        rationale</a>.
      </p>
<div class="warning"><table border="0" summary="Warning">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="../../../doc/src/images/warning.png"></td>
<th align="left">Warning</th>
</tr>
<tr><td align="left" valign="top"><p>
          Because of special behavior of the variance, adding a histogram to itself
          is not identical to multiplying the original histogram by two, as far as
          the variance is concerned.
        </p></td></tr>
</table></div>
<div class="note"><table border="0" summary="Note">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="../../../doc/src/images/note.png"></td>
<th align="left">Note</th>
</tr>
<tr><td align="left" valign="top"><p>
          Scaling a histogram automatically converts the bin counters from an integral
          number per bin to two real numbers per bin, if that has not happened already,
          because value and variance are different after the multiplication.
        </p></td></tr>
</table></div>
<p>
        Here is an example which demonstrates the supported operators.
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="comment">// make two histograms</span>
  <span class="keyword">auto</span> <span class="identifier">h1</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">));</span>
  <span class="keyword">auto</span> <span class="identifier">h2</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">));</span>

  <span class="identifier">h1</span><span class="special">(-</span><span class="number">0.5</span><span class="special">);</span> <span class="comment">// counts are: 1 0</span>
  <span class="identifier">h2</span><span class="special">(</span><span class="number">0.5</span><span class="special">);</span>  <span class="comment">// counts are: 0 1</span>

  <span class="comment">// add them</span>
  <span class="keyword">auto</span> <span class="identifier">h3</span> <span class="special">=</span> <span class="identifier">h1</span><span class="special">;</span>
  <span class="identifier">h3</span> <span class="special">+=</span> <span class="identifier">h2</span><span class="special">;</span> <span class="comment">// counts are: 1 1</span>

  <span class="comment">// adding multiple histograms at once is efficient and does not create</span>
  <span class="comment">// superfluous temporaries since operator+ functions are overloaded to</span>
  <span class="comment">// accept and return rvalue references where possible</span>
  <span class="keyword">auto</span> <span class="identifier">h4</span> <span class="special">=</span> <span class="identifier">h1</span> <span class="special">+</span> <span class="identifier">h2</span> <span class="special">+</span> <span class="identifier">h3</span><span class="special">;</span> <span class="comment">// counts are: 2 2</span>

  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">h4</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">h4</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">1</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 2 2</span>

  <span class="comment">// multiply by number</span>
  <span class="identifier">h4</span> <span class="special">*=</span> <span class="number">2</span><span class="special">;</span> <span class="comment">// counts are: 4 4</span>

  <span class="comment">// divide by number</span>
  <span class="keyword">auto</span> <span class="identifier">h5</span> <span class="special">=</span> <span class="identifier">h4</span> <span class="special">/</span> <span class="number">4</span><span class="special">;</span> <span class="comment">// counts are: 1 1</span>

  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">h5</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">h5</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="number">1</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 1 1</span>

  <span class="comment">// compare histograms</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">h4</span> <span class="special">==</span> <span class="number">4</span> <span class="special">*</span> <span class="identifier">h5</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">h4</span> <span class="special">!=</span> <span class="identifier">h5</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 1 1</span>

  <span class="comment">// note: special effect of multiplication on counter variance</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">));</span>
  <span class="identifier">h</span><span class="special">(-</span><span class="number">0.5</span><span class="special">);</span> <span class="comment">// counts are: 1 0</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"value    "</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="number">2</span> <span class="special">*</span> <span class="identifier">h</span><span class="special">).</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span>
            <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">h</span> <span class="special">+</span> <span class="identifier">h</span><span class="special">).</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">"\n"</span>
            <span class="special">&lt;&lt;</span> <span class="string">"variance "</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="number">2</span> <span class="special">*</span> <span class="identifier">h</span><span class="special">).</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">).</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span>
            <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">h</span> <span class="special">+</span> <span class="identifier">h</span><span class="special">).</span><span class="identifier">at</span><span class="special">(</span><span class="number">0</span><span class="special">).</span><span class="identifier">variance</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// equality operator also checks variances, so the statement is false</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">h</span> <span class="special">+</span> <span class="identifier">h</span> <span class="special">==</span> <span class="number">2</span> <span class="special">*</span> <span class="identifier">h</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">/* prints:
      value    2 2
      variance 4 2
      0
  */</span>
<span class="special">}</span>
</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.reductions"></a><a class="link" href="guide.html#histogram.guide.reductions" title="Reductions">Reductions</a>
</h3></div></div></div>
<p>
        When you have a high-dimensional histogram, sometimes you want to remove
        some axes and look the equivalent lower-dimensional version obtained by summing
        over the counts along the removed axes. Perhaps you found out that there
        is no interesting structure along an axis, so it is not worth keeping that
        axies around, or you want to visualize 1d or 2d projections of a high-dimensional
        histogram.
      </p>
<p>
        For this purpose use the <code class="computeroutput"><span class="identifier">histogram</span><span class="special">::</span><span class="identifier">reduce_to</span><span class="special">(...)</span></code> method, which returns a new reduced
        histogram with fewer axes. The method accepts indices (one or more), which
        indicate the axes that are kept. The static histogram only accepts compile-time
        numbers, while the dynamic histogram also accepts runtime numbers and iterators
        over numbers.
      </p>
<p>
        Here is an example to illustrates this.
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="comment">// example of a generic function for histograms, this one sums all entries</span>
<span class="keyword">template</span> <span class="special">&lt;</span><span class="keyword">typename</span><span class="special">...</span> <span class="identifier">Ts</span><span class="special">&gt;</span>
<span class="keyword">typename</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">&lt;</span><span class="identifier">Ts</span><span class="special">...&gt;::</span><span class="identifier">element_type</span> <span class="identifier">sum</span><span class="special">(</span>
    <span class="keyword">const</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">&lt;</span><span class="identifier">Ts</span><span class="special">...&gt;&amp;</span> <span class="identifier">h</span><span class="special">)</span> <span class="special">{</span>
  <span class="keyword">auto</span> <span class="identifier">result</span> <span class="special">=</span> <span class="keyword">typename</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">&lt;</span><span class="identifier">Ts</span><span class="special">...&gt;::</span><span class="identifier">element_type</span><span class="special">(</span><span class="number">0</span><span class="special">);</span>
  <span class="keyword">for</span> <span class="special">(</span><span class="keyword">auto</span> <span class="identifier">x</span> <span class="special">:</span> <span class="identifier">h</span><span class="special">)</span> <span class="identifier">result</span> <span class="special">+=</span> <span class="identifier">x</span><span class="special">;</span>
  <span class="keyword">return</span> <span class="identifier">result</span><span class="special">;</span>
<span class="special">}</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">literals</span><span class="special">;</span> <span class="comment">// enables _c suffix</span>

  <span class="comment">// make a 2d histogram</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">3</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">),</span>
                                     <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">integer</span><span class="special">&lt;&gt;(</span><span class="number">0</span><span class="special">,</span> <span class="number">4</span><span class="special">));</span>

  <span class="identifier">h</span><span class="special">(-</span><span class="number">0.9</span><span class="special">,</span> <span class="number">0</span><span class="special">);</span>
  <span class="identifier">h</span><span class="special">(</span><span class="number">0.9</span><span class="special">,</span> <span class="number">3</span><span class="special">);</span>
  <span class="identifier">h</span><span class="special">(</span><span class="number">0.1</span><span class="special">,</span> <span class="number">2</span><span class="special">);</span>

  <span class="keyword">auto</span> <span class="identifier">hr0</span> <span class="special">=</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">reduce_to</span><span class="special">(</span><span class="number">0</span><span class="identifier">_c</span><span class="special">);</span> <span class="comment">// keep only first axis</span>
  <span class="keyword">auto</span> <span class="identifier">hr1</span> <span class="special">=</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">reduce_to</span><span class="special">(</span><span class="number">1</span><span class="identifier">_c</span><span class="special">);</span> <span class="comment">// keep only second axis</span>

  <span class="comment">/*
      reduce does not remove counts; returned histograms are summed over
      the removed axes, so h, hr0, and hr1 have same number of total counts
  */</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">sum</span><span class="special">(</span><span class="identifier">h</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span> <span class="special">&lt;&lt;</span> <span class="identifier">sum</span><span class="special">(</span><span class="identifier">hr0</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span>
            <span class="special">&lt;&lt;</span> <span class="identifier">sum</span><span class="special">(</span><span class="identifier">hr1</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 3 3 3</span>

  <span class="keyword">for</span> <span class="special">(</span><span class="keyword">auto</span> <span class="identifier">yi</span> <span class="special">:</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">axis</span><span class="special">(</span><span class="number">1</span><span class="identifier">_c</span><span class="special">))</span> <span class="special">{</span>
    <span class="keyword">for</span> <span class="special">(</span><span class="keyword">auto</span> <span class="identifier">xi</span> <span class="special">:</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">axis</span><span class="special">(</span><span class="number">0</span><span class="identifier">_c</span><span class="special">))</span> <span class="special">{</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="identifier">xi</span><span class="special">,</span> <span class="identifier">yi</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span><span class="special">;</span> <span class="special">}</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="special">}</span>
  <span class="comment">// prints: 1 0 0</span>
  <span class="comment">//         0 0 0</span>
  <span class="comment">//         0 1 0</span>
  <span class="comment">//         0 0 1</span>

  <span class="keyword">for</span> <span class="special">(</span><span class="keyword">auto</span> <span class="identifier">xi</span> <span class="special">:</span> <span class="identifier">hr0</span><span class="special">.</span><span class="identifier">axis</span><span class="special">())</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">hr0</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="identifier">xi</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span><span class="special">;</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 1 1 1</span>

  <span class="keyword">for</span> <span class="special">(</span><span class="keyword">auto</span> <span class="identifier">yi</span> <span class="special">:</span> <span class="identifier">hr1</span><span class="special">.</span><span class="identifier">axis</span><span class="special">())</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">hr1</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="identifier">yi</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" "</span><span class="special">;</span>
  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: 1 0 1 1</span>
<span class="special">}</span>
</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.streaming"></a><a class="link" href="guide.html#histogram.guide.streaming" title="Streaming">Streaming</a>
</h3></div></div></div>
<p>
        Simple ostream operators are shipped with the library, which are internally
        used by the unit tests. These give text representations of axis and histogram
        configurations, but do not show the histogram content. They may be useful
        for debugging, but users are encouraged to write their own ostream operators.
        Therefore, the headers with the builtin implementations are not included
        by the super header <code class="computeroutput"><span class="preprocessor">#include</span>
        <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code>,
        so that users can use their own implementations. The following example shows
        the effect of output streaming.
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">/</span><span class="identifier">ostream_operators</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="keyword">namespace</span> <span class="identifier">axis</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">::</span><span class="identifier">axis</span><span class="special">;</span>

  <span class="keyword">enum</span> <span class="special">{</span> <span class="identifier">A</span><span class="special">,</span> <span class="identifier">B</span><span class="special">,</span> <span class="identifier">C</span> <span class="special">};</span>

  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span>
      <span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">,</span> <span class="string">"regular1"</span><span class="special">,</span> <span class="identifier">axis</span><span class="special">::</span><span class="identifier">uoflow_type</span><span class="special">::</span><span class="identifier">off</span><span class="special">),</span>
      <span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">transform</span><span class="special">::</span><span class="identifier">log</span><span class="special">&gt;(</span><span class="number">2</span><span class="special">,</span> <span class="number">1</span><span class="special">,</span> <span class="number">10</span><span class="special">,</span> <span class="string">"regular2"</span><span class="special">),</span>
      <span class="identifier">axis</span><span class="special">::</span><span class="identifier">circular</span><span class="special">&lt;&gt;(</span><span class="number">4</span><span class="special">,</span> <span class="number">0.1</span><span class="special">,</span> <span class="number">1.0</span><span class="special">,</span> <span class="string">"polar"</span><span class="special">),</span>
      <span class="identifier">axis</span><span class="special">::</span><span class="identifier">variable</span><span class="special">&lt;&gt;({-</span><span class="number">1</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">1</span><span class="special">},</span> <span class="string">"variable"</span><span class="special">,</span> <span class="identifier">axis</span><span class="special">::</span><span class="identifier">uoflow_type</span><span class="special">::</span><span class="identifier">off</span><span class="special">),</span>
      <span class="identifier">axis</span><span class="special">::</span><span class="identifier">category</span><span class="special">&lt;&gt;({</span><span class="identifier">A</span><span class="special">,</span> <span class="identifier">B</span><span class="special">,</span> <span class="identifier">C</span><span class="special">},</span> <span class="string">"category"</span><span class="special">),</span>
      <span class="identifier">axis</span><span class="special">::</span><span class="identifier">integer</span><span class="special">&lt;&gt;(-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">,</span> <span class="string">"integer"</span><span class="special">,</span> <span class="identifier">axis</span><span class="special">::</span><span class="identifier">uoflow_type</span><span class="special">::</span><span class="identifier">off</span><span class="special">));</span>

  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>

  <span class="comment">/* prints:

  histogram(
    regular(2, -1, 1, label='regular1', uoflow=False),
    regular_log(2, 1, 10, label='regular2'),
    circular(4, phase=0.1, perimeter=1, label='polar'),
    variable(-1, 0, 1, label='variable', uoflow=False),
    category(0, 1, 2, label='category'),
    integer(-1, 1, label='integer', uoflow=False),
  )

  */</span>
<span class="special">}</span>
</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.serialization"></a><a class="link" href="guide.html#histogram.guide.serialization" title="Serialization">Serialization</a>
</h3></div></div></div>
<p>
        The library supports serialization via <a href="../../../libs/serialization/index.html" target="_top">Boost.Serialization</a>.
        The serialization code is not included by the super header <code class="computeroutput"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span></code>,
        so that the library can be used without Boost.Serialization.
      </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">archive</span><span class="special">/</span><span class="identifier">text_iarchive</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">archive</span><span class="special">/</span><span class="identifier">text_oarchive</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">/</span><span class="identifier">serialization</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span> <span class="comment">// includes serialization code</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">sstream</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="keyword">auto</span> <span class="identifier">a</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">3</span><span class="special">,</span> <span class="special">-</span><span class="number">1</span><span class="special">,</span> <span class="number">1</span><span class="special">,</span> <span class="string">"r"</span><span class="special">),</span>
                                     <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">integer</span><span class="special">&lt;&gt;(</span><span class="number">0</span><span class="special">,</span> <span class="number">2</span><span class="special">,</span> <span class="string">"i"</span><span class="special">));</span>
  <span class="identifier">a</span><span class="special">(</span><span class="number">0.5</span><span class="special">,</span> <span class="number">1</span><span class="special">);</span>

  <span class="identifier">std</span><span class="special">::</span><span class="identifier">string</span> <span class="identifier">buf</span><span class="special">;</span> <span class="comment">// holds persistent representation</span>

  <span class="comment">// store histogram</span>
  <span class="special">{</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">ostringstream</span> <span class="identifier">os</span><span class="special">;</span>
    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">archive</span><span class="special">::</span><span class="identifier">text_oarchive</span> <span class="identifier">oa</span><span class="special">(</span><span class="identifier">os</span><span class="special">);</span>
    <span class="identifier">oa</span> <span class="special">&lt;&lt;</span> <span class="identifier">a</span><span class="special">;</span>
    <span class="identifier">buf</span> <span class="special">=</span> <span class="identifier">os</span><span class="special">.</span><span class="identifier">str</span><span class="special">();</span>
  <span class="special">}</span>

  <span class="keyword">auto</span> <span class="identifier">b</span> <span class="special">=</span> <span class="keyword">decltype</span><span class="special">(</span><span class="identifier">a</span><span class="special">)();</span> <span class="comment">// create a default-constructed second histogram</span>

  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"before restore "</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">a</span> <span class="special">==</span> <span class="identifier">b</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: before restore 0</span>

  <span class="comment">// load histogram</span>
  <span class="special">{</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">istringstream</span> <span class="identifier">is</span><span class="special">(</span><span class="identifier">buf</span><span class="special">);</span>
    <span class="identifier">boost</span><span class="special">::</span><span class="identifier">archive</span><span class="special">::</span><span class="identifier">text_iarchive</span> <span class="identifier">ia</span><span class="special">(</span><span class="identifier">is</span><span class="special">);</span>
    <span class="identifier">ia</span> <span class="special">&gt;&gt;</span> <span class="identifier">b</span><span class="special">;</span>
  <span class="special">}</span>

  <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"after restore "</span> <span class="special">&lt;&lt;</span> <span class="special">(</span><span class="identifier">a</span> <span class="special">==</span> <span class="identifier">b</span><span class="special">)</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="comment">// prints: after restore 1</span>
<span class="special">}</span>
</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="histogram.guide.expert"></a><a class="link" href="guide.html#histogram.guide.expert" title="Advanced usage">Advanced usage</a>
</h3></div></div></div>
<div class="toc"><dl class="toc">
<dt><span class="section"><a href="guide.html#histogram.guide.expert.user_defined_axis_class">User-defined
        axis class</a></span></dt>
<dt><span class="section"><a href="guide.html#histogram.guide.expert.user_defined_storage_policy">User-defined
        storage policy</a></span></dt>
</dl></div>
<p>
        The library is customizable and extensible by users. Users can create new
        axis classes and use them with the histogram, or implemented a custom storage
        policy, or use a builtin storage policy with a custom counter type.
      </p>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="histogram.guide.expert.user_defined_axis_class"></a><a class="link" href="guide.html#histogram.guide.expert.user_defined_axis_class" title="User-defined axis class">User-defined
        axis class</a>
</h4></div></div></div>
<p>
          In C++, users can implement their own axis class without touching any library
          code. The custom axis is just passed to the histogram factories <code class="computeroutput"><span class="identifier">make_static_histogram</span><span class="special">(...)</span></code>
          and <code class="computeroutput"><span class="identifier">make_dynamic_histogram</span><span class="special">(...)</span></code>. The custom axis class must meet the
          requirements of the <a class="link" href="concepts.html#histogram.concepts.axis" title="Axis type">axis concept</a>.
        </p>
<p>
          The simplest way to make a custom axis is to derive from a builtin class.
          Here is a contrieved example of a custom axis that inherits from the <code class="computeroutput"><a class="link" href="../boost/histogram/axis/integer.html" title="Class template integer">integer axis</a></code> and accepts
          c-strings representing numbers.
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">iostream</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="comment">// custom axis, which adapts builtin integer axis</span>
<span class="keyword">struct</span> <span class="identifier">custom_axis</span> <span class="special">:</span> <span class="keyword">public</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">integer</span><span class="special">&lt;&gt;</span> <span class="special">{</span>
  <span class="keyword">using</span> <span class="identifier">value_type</span> <span class="special">=</span> <span class="keyword">const</span> <span class="keyword">char</span><span class="special">*;</span> <span class="comment">// type that is fed to the axis</span>

  <span class="keyword">using</span> <span class="identifier">integer</span><span class="special">::</span><span class="identifier">integer</span><span class="special">;</span> <span class="comment">// inherit ctors of base</span>

  <span class="comment">// the customization point</span>
  <span class="comment">// - accept const char* and convert to int</span>
  <span class="comment">// - then call index method of base class</span>
  <span class="keyword">int</span> <span class="identifier">index</span><span class="special">(</span><span class="identifier">value_type</span> <span class="identifier">s</span><span class="special">)</span> <span class="keyword">const</span> <span class="special">{</span> <span class="keyword">return</span> <span class="identifier">integer</span><span class="special">::</span><span class="identifier">index</span><span class="special">(</span><span class="identifier">std</span><span class="special">::</span><span class="identifier">atoi</span><span class="special">(</span><span class="identifier">s</span><span class="special">));</span> <span class="special">}</span>
<span class="special">};</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram</span><span class="special">(</span><span class="identifier">custom_axis</span><span class="special">(</span><span class="number">0</span><span class="special">,</span> <span class="number">3</span><span class="special">));</span>
  <span class="identifier">h</span><span class="special">(</span><span class="string">"-10"</span><span class="special">);</span>
  <span class="identifier">h</span><span class="special">(</span><span class="string">"0"</span><span class="special">);</span>
  <span class="identifier">h</span><span class="special">(</span><span class="string">"1"</span><span class="special">);</span>
  <span class="identifier">h</span><span class="special">(</span><span class="string">"9"</span><span class="special">);</span>

  <span class="keyword">for</span> <span class="special">(</span><span class="keyword">auto</span> <span class="identifier">xi</span> <span class="special">:</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">axis</span><span class="special">())</span> <span class="special">{</span>
    <span class="identifier">std</span><span class="special">::</span><span class="identifier">cout</span> <span class="special">&lt;&lt;</span> <span class="string">"bin "</span> <span class="special">&lt;&lt;</span> <span class="identifier">xi</span><span class="special">.</span><span class="identifier">idx</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">" ["</span> <span class="special">&lt;&lt;</span> <span class="identifier">xi</span><span class="special">.</span><span class="identifier">lower</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">", "</span>
              <span class="special">&lt;&lt;</span> <span class="identifier">xi</span><span class="special">.</span><span class="identifier">upper</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="string">") "</span> <span class="special">&lt;&lt;</span> <span class="identifier">h</span><span class="special">.</span><span class="identifier">at</span><span class="special">(</span><span class="identifier">xi</span><span class="special">).</span><span class="identifier">value</span><span class="special">()</span> <span class="special">&lt;&lt;</span> <span class="identifier">std</span><span class="special">::</span><span class="identifier">endl</span><span class="special">;</span>
  <span class="special">}</span>

  <span class="comment">/* prints:
      bin 0 [0, 1) 1
      bin 1 [1, 2] 1
      bin 2 [2, 3] 0
  */</span>
<span class="special">}</span>
</pre>
</div>
<div class="section">
<div class="titlepage"><div><div><h4 class="title">
<a name="histogram.guide.expert.user_defined_storage_policy"></a><a class="link" href="guide.html#histogram.guide.expert.user_defined_storage_policy" title="User-defined storage policy">User-defined
        storage policy</a>
</h4></div></div></div>
<p>
          Histograms can be created with a different storage policy than the default
          <code class="computeroutput"><a class="link" href="../boost/histogram/adaptive_storage.html" title="Struct template adaptive_storage">adaptive_storage</a></code>,
          using the templated factories <code class="computeroutput"><a class="link" href="reference.html#boost.histogram.make_static_histogram_with">make_static_histogram_with</a></code>
          and <code class="computeroutput"><a class="link" href="reference.html#boost.histogram.make_dynam_idm499186007120">make_dynamic_histogram_with</a></code>.
        </p>
<p>
          A simple alternative, <code class="computeroutput"><a class="link" href="../boost/histogram/array_storage.html" title="Struct template array_storage">array_storage</a></code>,
          is included in the library. It does not do dynamic counter management,
          instead it is templated and lets the user statically choose the counter
          type, which stores the count per bin. Usually, this would be an integral
          or floating point type. If performance is a concern, you could give this
          storage policy a try, since it may be faster for low-dimensional histograms
          (but it can be slower as well, just try it out and measure).
        </p>
<p>
          If you work exclusively with weighted fills, <code class="computeroutput"><a class="link" href="../boost/histogram/array_storage.html" title="Struct template array_storage">array_storage</a></code>
          will be faster than <code class="computeroutput"><a class="link" href="../boost/histogram/adaptive_storage.html" title="Struct template adaptive_storage">adaptive_storage</a></code>.
          If you want to have a variance estimate for weighted fills, use <code class="computeroutput"><a class="link" href="../boost/histogram/weight_counter.html" title="Class template weight_counter">weight_counter</a></code> as the
          template argument for <code class="computeroutput"><a class="link" href="../boost/histogram/array_storage.html" title="Struct template array_storage">array_storage</a></code>.
        </p>
<p>
          Here is an example of a histogram construced with an alternative storage
          policy.
        </p>
<pre class="programlisting"><span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>
<span class="preprocessor">#include</span> <span class="special">&lt;</span><span class="identifier">boost</span><span class="special">/</span><span class="identifier">histogram</span><span class="special">/</span><span class="identifier">storage</span><span class="special">/</span><span class="identifier">array_storage</span><span class="special">.</span><span class="identifier">hpp</span><span class="special">&gt;</span>

<span class="keyword">namespace</span> <span class="identifier">bh</span> <span class="special">=</span> <span class="identifier">boost</span><span class="special">::</span><span class="identifier">histogram</span><span class="special">;</span>

<span class="keyword">int</span> <span class="identifier">main</span><span class="special">()</span> <span class="special">{</span>
  <span class="comment">// create static histogram with array_storage, using int as counter type</span>
  <span class="keyword">auto</span> <span class="identifier">h</span> <span class="special">=</span> <span class="identifier">bh</span><span class="special">::</span><span class="identifier">make_static_histogram_with</span><span class="special">(</span><span class="identifier">bh</span><span class="special">::</span><span class="identifier">array_storage</span><span class="special">&lt;</span><span class="keyword">int</span><span class="special">&gt;(),</span>
                                          <span class="identifier">bh</span><span class="special">::</span><span class="identifier">axis</span><span class="special">::</span><span class="identifier">regular</span><span class="special">&lt;&gt;(</span><span class="number">10</span><span class="special">,</span> <span class="number">0</span><span class="special">,</span> <span class="number">1</span><span class="special">));</span>

  <span class="comment">// do something with h</span>
<span class="special">}</span>
</pre>
<div class="warning"><table border="0" summary="Warning">
<tr>
<td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="../../../doc/src/images/warning.png"></td>
<th align="left">Warning</th>
</tr>
<tr><td align="left" valign="top"><p>
            The guarantees regarding protection against overflow and count capping
            are only valid, if the default <code class="computeroutput"><a class="link" href="../boost/histogram/adaptive_storage.html" title="Struct template adaptive_storage">adaptive_storage</a></code>
            is used. If you change the storage policy, you need know what you are
            doing.
          </p></td></tr>
</table></div>
</div>
</div>
<div class="footnotes">
<br><hr style="width:100; text-align:left;margin-left: 0">
<div id="ftn.histogram.guide.introduction.f0" class="footnote"><p><a href="#histogram.guide.introduction.f0" class="para"><sup class="para">[2] </sup></a>
          What small enough means has to be decided case by case.
        </p></div>
</div>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2016, 2017 Hans Dembinski<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="getting_started.html"><img src="../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../index.html"><img src="../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../index.html"><img src="../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="benchmarks.html"><img src="../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
